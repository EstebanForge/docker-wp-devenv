# SSL Configuration Guide

## Overview
This WordPress Docker environment includes SSL support using locally trusted certificates generated by mkcert. This provides secure HTTPS connections without browser warnings during development.

## Features
- **Trusted Certificates**: No browser security warnings
- **Automatic HTTPS**: HTTP requests redirect to HTTPS
- **Modern SSL**: TLS 1.2+ with secure cipher suites
- **Security Headers**: HSTS, X-Frame-Options, CSP headers

## Setup

### Automatic Setup (Recommended)
SSL is automatically configured when running the main setup script:
```bash
./setup.sh
```

### Manual Setup
If you need to set up SSL separately:
```bash
# Generate SSL certificates
chmod +x scripts/setup-ssl.sh
./scripts/setup-ssl.sh

# Regenerate Nginx configuration
./scripts/generate-nginx-config.sh

# Restart containers
docker-compose restart
```

## How It Works

### Certificate Generation
1. **mkcert Installation**: Installs mkcert if not present
2. **Local CA**: Creates and installs a local Certificate Authority
3. **Domain Certificates**: Generates certificates for your domain
4. **Browser Trust**: Certificates are automatically trusted

### Nginx Configuration
- **HTTP Redirect**: All HTTP traffic redirects to HTTPS
- **SSL Termination**: Nginx handles SSL termination
- **Security Headers**: Modern security headers included
- **HTTP/2 Support**: Enables HTTP/2 for better performance

## File Structure
```
ssl/
├── wp.localhost.crt     # SSL certificate
└── wp.localhost.key     # Private key
```

## Security Configuration

### SSL Protocols
- **TLS 1.2** and **TLS 1.3** only
- **Secure ciphers** with forward secrecy
- **HSTS header** for security

### Security Headers
```nginx
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
Referrer-Policy: strict-origin-when-cross-origin
```

## WordPress Integration

### URL Configuration
WordPress is automatically configured to use HTTPS:
- **Home URL**: `https://your-domain.localhost`
- **Site URL**: `https://your-domain.localhost`
- **Admin URLs**: All admin links use HTTPS

### Mixed Content Prevention
- **HTTPS Parameter**: PHP receives `HTTPS=on`
- **Secure Cookies**: WordPress uses secure cookies
- **Asset URLs**: All assets load over HTTPS

## Browser Support

### Supported Browsers
- **Chrome/Chromium**: Full support
- **Firefox**: Full support
- **Safari**: Full support
- **Edge**: Full support

### Certificate Trust
Certificates are trusted because:
1. **Local CA**: mkcert installs a local Certificate Authority
2. **System Trust**: CA is added to system trust store
3. **Browser Trust**: Browsers trust the local CA

## Troubleshooting

### Certificate Issues
```bash
# Check certificate validity
openssl x509 -in ssl/wp.localhost.crt -text -noout

# Verify certificate chain
openssl verify ssl/wp.localhost.crt

# Check private key
openssl rsa -in ssl/wp.localhost.key -check
```

### Browser Not Trusting Certificate
```bash
# Reinstall local CA
mkcert -uninstall
mkcert -install

# Regenerate certificates
rm ssl/*
./scripts/setup-ssl.sh
```

### Nginx SSL Errors
```bash
# Check Nginx configuration
docker-compose exec webserver nginx -t

# View SSL-specific logs
docker-compose logs webserver | grep -i ssl
```

### Mixed Content Warnings
If you see mixed content warnings:
1. **Check WordPress URLs**:
   ```bash
   ./wp option get home
   ./wp option get siteurl
   ```

2. **Update to HTTPS**:
   ```bash
   ./wp option update home "https://your-domain.localhost"
./wp option update siteurl "https://your-domain.localhost"
   ```

## Development Workflow

### New Domain Setup
When changing domains:
```bash
# Update .env file
WP_DOMAIN=new-domain.localhost

# Regenerate certificates
./scripts/setup-ssl.sh

# Update Nginx config
./scripts/generate-nginx-config.sh

# Restart containers
docker-compose restart
```

### Certificate Renewal
Certificates generated by mkcert are valid for 10 years, so renewal is rarely needed. If needed:
```bash
# Remove old certificates
rm ssl/*

# Generate new certificates
./scripts/setup-ssl.sh

# Restart web server
docker-compose restart webserver
```

## Production Considerations

### For Production Deployment
- **Real Certificates**: Use Let's Encrypt or commercial certificates
- **Certificate Management**: Implement automated renewal
- **Security Hardening**: Additional security headers and configurations

### Migration from Development
When moving to production:
1. **Remove mkcert certificates**
2. **Install production certificates**
3. **Update security headers**
4. **Configure proper HSTS**

## Security Best Practices

### Certificate Security
- **Private Key Protection**: Keys have restrictive permissions (600)
- **Regular Updates**: Keep mkcert updated
- **Secure Storage**: Don't commit certificates to version control

### SSL Configuration
- **Strong Ciphers**: Only secure cipher suites enabled
- **Protocol Versions**: Only TLS 1.2+ supported
- **Perfect Forward Secrecy**: Ephemeral key exchange
